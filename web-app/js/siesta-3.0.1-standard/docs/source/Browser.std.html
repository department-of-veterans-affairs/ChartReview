<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*

Siesta 3.0.1
Copyright(c) 2009-2015 Bryntum AB
http://bryntum.com/contact
http://bryntum.com/products/siesta/license

*/
Siesta.Test.Browser.meta.extend({

    override : {
        
<span id='Siesta-Test-Browser-method-waitForPageLoad'>        /**
</span>         * **This feature is available only in Standard package**.
         * 
         * Only useful along with {@link Siesta.Harness.Browser.separateContext separateContext} option 
         * 
         * Wait for the page load to occur and runs the callback. The callback will receive a &quot;window&quot; object.
         * Should be used when you are doing a redirect / refresh of the test page:
         * 
         *      t.waitForPageLoad(function (window) {
         *          ...
         *      })
         * 
         * Note, that method obviously must be called before the new page has completed loading, otherwise it will
         * wait indefinitely and fail (since there will be no page load). So, to avoid the race conditions, one 
         * should always start waiting for page load *before* the action, that causes it. 
         * 
         * Consider the following example (where click on the `&gt;&gt; #loginPanel button` trigger a page redirect):

    // this code does not reliably - it contains a race condition
    // in Chrome, page refresh may happen too fast (even synchronously),
    // so, by the time the `waitForPageLoad` action will start, the page load event will already happen
    // and `waitForPageLoad` will wait indefinitely 
    { click : '&gt;&gt; #loginPanel button' },
    { waitFor : 'PageLoad'}
         * &amp;nbsp;

    // Need to start waiting first, and only then - click
    // we'll use &quot;trigger&quot; config of the `wait` action for that
    {
        waitFor     : 'PageLoad',
        trigger     : {
            click : '&gt;&gt; #loginPanel button'
        }
    }
    // or, same action using function step:
    function (next) {
        t.waitForPageLoad(next)
        
        t.click('&gt;&gt; #loginPanel button', function () {})
    }

         * 
         * @method
         * @member Siesta.Test.Browser 
         */
        waitForPageLoad : function (callback, scope) {
            var me              = this
            
            var global          = this.global
            var unloaded        = false
            
            var onUnloadHandler = function () {
                global.removeEventListener('unload', onUnloadHandler)
                
                unloaded        = true
            }
            
            global.addEventListener('unload', onUnloadHandler)
            
            this.chain(
                { waitFor : function () {
                    return unloaded || me.global.document.readyState != 'complete'
                }},
                function (next) {
                    global.removeEventListener('unload', onUnloadHandler)
                    
                    global          = null
                    onUnloadHandler = null
                    
                    next()
                },
                { waitFor : function () {
                    return me.global.document.readyState == 'complete'
                }},
                { waitFor : 50 },
                function () {
                    callback &amp;&amp; me.processCallbackFromTest(callback, [ me.global ], scope || me)
                }
            )
        },
        
        
<span id='Siesta-Test-Browser-method-setTimeout'>        /**
</span>         * **This feature is available only in Standard package**.
         * 
         * This method will just call the `setTimeout` method from the scope of the test page.
         * 
         * Usually you don't need to use it - you can just call `setTimeout`, but if your test scripts resides in the
         * separate context, you need to use this method for `setTimeout` functionality. See documentation for {@link Siesta.Harness.Browser#separateContext separateContext}
         * option and &lt;a href=&quot;#!/guide/cross_page_testing&quot;&gt;Cross page testing&lt;/a&gt; guide.
         * 
         * @param {Function} func The function to call after specified `delay`
         * @param {Number} delay The time to wait (in ms) before calling the `func`
         * @return {Number} timeoutId The id of the timeout, can be passed to {@link #clearTimeout} to cancel the function execution.
         * 
         * @method
         * @member Siesta.Test.Browser 
         */
        setTimeout : function (func, delay) {
            var pageSetTimeout = this.global.setTimeout
            
            pageSetTimeout(func, delay)
        },
        
        
<span id='Siesta-Test-Browser-method-clearTimeout'>        /**
</span>         * **This feature is available only in Standard package**.
         * 
         * This method will just call the `clearTimeout` method from the scope of the test page.
         * 
         * Usually you don't need to use it - you can just call `clearTimeout`, but if your test scripts resides in the
         * separate context, you need to use this method for `clearTimeout` functionality. See documentation for {@link Siesta.Harness.Browser#separateContext separateContext}
         * option and &lt;a href=&quot;#!/guide/cross_page_testing&quot;&gt;Cross page testing&lt;/a&gt; guide.
         * 
         * @param {Number} timeoutId The id of the timeout, recevied from the {@link #setTimeout} call
         * 
         * @method
         * @member Siesta.Test.Browser 
         */
        clearTimeout : function (id) {
            var pageClearTimeout = this.global.clearTimeout
            
            pageClearTimeout(id)
        }
    }
});
</pre>
</body>
</html>
